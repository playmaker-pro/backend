{% extends "admin/base_site.html" %}
{% load static %}

{% block branding %}
<h1 id="site-name"><a href="{% url 'admin:index' %}">Django Admin</a></h1>
{% endblock %}

{% block content %}
<div class="module">
    {% if error %}
        <div class="messagelist">
            <div class="error">{{ error }}</div>
        </div>
    {% else %}

        <!-- User Info -->
        <div class="form-row">
            <div>
                <strong>User:</strong> {{ user.get_full_name|default:user.email }}<br>
                <strong>Email:</strong> {{ user.email }}<br>
                <strong>User ID:</strong> {{ user.id }}<br>
                <a href="{% url 'admin:users_user_changelist' %}">&larr; Back to User Admin</a>
            </div>
        </div>

        <!-- Summary Statistics -->
        <div class="module">
            <h2>Login Statistics</h2>
            <div class="form-row">
                <div style="display: flex; gap: 30px; margin: 15px 0;">
                    <div><strong>Total Login Days:</strong> {{ total_days }}</div>
                    <div><strong>Total Logins:</strong> {{ total_logins }}</div>
                    <div><strong>Current Streak:</strong> {{ current_streak }} days</div>
                </div>
            </div>
        </div>
        
        <!-- Pagination Info -->
        {% if total_records > 0 %}
        <div class="module">
            <div class="form-row">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>Showing {{ login_history|length }} of {{ total_records }} records</strong>
                        (Page {{ page }} of {{ total_pages }})
                    </div>
                    <div>
                        <label for="per_page">Records per page:</label>
                        <select id="per_page" onchange="changePerPage(this.value)" style="margin-left: 5px;">
                            <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                            <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
                            <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                            <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        <!-- Login History Table -->
        {% if login_history %}
            <div class="module">
                <div class="results">
                    <table id="result_list">
                        <thead>
                            <tr>
                                <th scope="col">Date</th>
                                <th scope="col">Day of Week</th>
                                <th scope="col">Login Count</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for entry in login_history %}
                                <tr class="{% cycle 'row1' 'row2' %}">
                                    <td>{{ entry.date_obj|date:'F d, Y' }}</td>
                                    <td>{{ entry.date_obj|date:'l' }}</td>
                                    <td>{{ entry.login_count }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination Navigation -->
                {% if total_pages > 1 %}
                <div class="pagination">
                    {% if has_previous %}
                        <a href="?page={{ previous_page }}&per_page={{ per_page }}" class="pagination-btn">&laquo; Previous</a>
                    {% else %}
                        <span class="pagination-btn disabled">&laquo; Previous</span>
                    {% endif %}
                    
                    <span class="pagination-info">Page {{ page }} of {{ total_pages }}</span>
                    
                    {% if has_next %}
                        <a href="?page={{ next_page }}&per_page={{ per_page }}" class="pagination-btn">Next &raquo;</a>
                    {% else %}
                        <span class="pagination-btn disabled">Next &raquo;</span>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        {% else %}
            <div class="module">
                <h2>No Login History Found</h2>
                <p>This user has no recorded login history in Mongo.</p>
            </div>
        {% endif %}
        
    {% endif %}
</div>

<style>
    .module {
        margin-bottom: 20px;
    }
    
    .form-row {
        padding: 10px;
        border-bottom: 1px solid #ddd;
    }
    
    #result_list {
        width: 100%;
        border-collapse: collapse;
    }
    
    #result_list th {
        background-color: #417690;
        color: white;
        padding: 10px;
        text-align: left;
    }
    
    #result_list td {
        padding: 8px;
        border-bottom: 1px solid #ddd;
    }
    
    .row1 {
        background-color: #f9f9f9;
    }
    
    .row2 {
        background-color: white;
    }
    
    .submit-row {
        padding: 12px 14px;
        margin: 0 0 20px;
        background: #f8f8f8;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    /* Pagination Styles - Minimal */
    .pagination {
        text-align: center;
        margin: 15px 0;
        padding: 10px;
        border-top: 1px solid #ddd;
    }
    
    .pagination-btn {
        display: inline-block;
        padding: 4px 8px;
        margin: 0 2px;
        text-decoration: none;
        color: #5b80b2;
        border: 1px solid #ddd;
        background: white;
    }
    
    .pagination-btn:hover {
        background-color: #f8f8f8;
        text-decoration: none;
    }
    
    .pagination-btn.disabled {
        color: #999;
        cursor: default;
        border-color: #eee;
    }
    
    .pagination-btn.current {
        background-color: #417690;
        color: white;
        border-color: #417690;
    }
    
    .pagination-info {
        margin: 0 10px;
        color: #666;
    }
</style>

<script>
function changePerPage(value) {
    const url = new URL(window.location);
    url.searchParams.set('per_page', value);
    url.searchParams.set('page', 1); // Reset to first page when changing per_page
    window.location.href = url.toString();
}
</script>
{% endblock %}
