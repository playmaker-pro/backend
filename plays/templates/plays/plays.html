{% extends 'platform/base.html' %}
{% load i18n %}
{% load static %}
{% load playmaker %}
{% block extra_css %}
    {{ block.super }}
    <link href="{% static 'assets/css/profiles.css' %}" rel="stylesheet">
{% endblock extra_css%}


{% block content_header %}
    {% include '_page_heading.html' with heading_title=page_title size=4 %}   
{% endblock %}


{% block content %}


<div class="row">

<div class="col-12 d-md-none">
    {% include "plays/partials/sidemenu_burger.html" with leagues_data=leagues2 %}
</div>

<section id="leagues-side-bar" class="col-2 d-none d-md-flex" style="background-color:#2b2b2b;" >
  <div class="container" data-aos="fade-up">
    <form>
        {% include 'plays/filters/season.html' %}
    </form>
    <select id="leagues-search" class="selectpicker" data-live-search="true" >
        {% for league in leagues %}
            {% if league|has_season_data:current_season %}
                <option data-tokens="{{league.name}} {{league.zpn}}"  value="{% url 'plays:summary' slug=league.slug  %}">{{ league.name }}</option>
            {% endif %}
        {% endfor %}
    </select>
    <div class="">
        {% for league in leagues %}
            {% if league.is_parent %}
                {{ league.name }}
                {% for child in league.league_set.all %}
                    {% if child|has_season_data:current_season %}
                        <div><a href="{% url 'plays:summary' slug=child.slug  %}">{{ child.name }}</a>{{ child.serach_index }}</div><br>
                    {% endif %}
                {% endfor %}
            {% else %}
                    {% if league|has_season_data:current_season %}
                    <div><a href="{% url 'plays:summary' slug=league.slug  %}">{{ league.name }}</a> {{ league.serach_index }}</div><br>
                    {% endif %}
            {% endif %}
        {% endfor %}
    </div>
</div>
</section>



<section id="plays" class="plays col-10" style="padding:0px 0px;">
{% include 'plays/header_black.html' %}
  <div class="container" data-aos="fade-up">
    <div class="">
        {% comment %} {% if page_obj.paginator.count == 0 %} {% endcomment %}
        {% if objects|length == 0 %}
            <div class="col-md-12 text-center">
                {% include 'profiles/partials/_empty_data.html' with empty_text="Brak danych" %}
            </div>

        {% else %}
            <div class="col">
            {% if tab == 'table' %}
                {% include 'plays/_tab_table.html' with objects=objects %}

            {% elif tab == 'matches' %}
                {% include 'plays/_tab_games.html' with objects=objects %}
            
            {% elif tab == 'scores' %}
                {% include 'plays/_tab_games.html' with objects=objects %}

            {% elif tab == 'playmaker' %}
                {% include 'plays/_tab_playmaker.html' with objects=objects %}

            {% else %}
                {% include 'plays/_tab_summary.html' with objects=objects %}
            {% endif %}
            </div>   
            <div class='col-md-12'>
                {% include 'platform/partials/_pagination.html' %}
            </div>       
        {% endif %}
    </div>
</div>
</section>
</div>
{% endblock %}


{% block extra_js %}
{{ block.super }}
<script src="{% static 'assets/js/filters.js' %}"></script>
{% include "plays/modals/modal_show_game.html" %}
<script>
    $('#leagues-search').on('changed.bs.select', function (e, clickedIndex, isSelected, previousValue) {
        window.location.href = this.value;
    });

    $('#search-season').on('changed.bs.select', function (e, clickedIndex, isSelected, previousValue) {
        var search_params = new URLSearchParams(window.location.search);
        search_params.set('season', this.value);
        window.location.search = search_params.toString();
    });

$('#showGameModal').on('show.bs.modal', function (event) {
    var data = $(event.relatedTarget).data('game-json');

    $(this).find('#md-gm-title').text(data.host + ' - ' + data.guest);
    $(this).find('#md-gm-score').text(data.score);
    $(this).find('#md-gm-sub').text(data.date);
    $(this).find('#md-gm-host').text(data.host);
    $(this).find('#md-gm-host').attr("href", data.host_url)
    $(this).find('#md-gm-guest').text(data.guest);
    $(this).find('#md-gm-guest').attr("href", data.guest_url)
});
</script>
{% endblock %}